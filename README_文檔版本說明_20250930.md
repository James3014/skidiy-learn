# ğŸ“š SDD-T æ–‡æª”ç‰ˆæœ¬èªªæ˜

## ğŸ†• æœ€æ–°ç‰ˆæœ¬ (2025-10-03 12:00) â­ï¸

### âœ… è«‹ä½¿ç”¨é€™äº›æ–‡æª”ï¼š

1. **ä¸»è¦æ ¼æ–‡ä»¶** (Human Readable)
   - `sdd-T-spec_20251002.md` â­ï¸ **é€™æ˜¯å”¯ä¸€æ­£å¼è¦æ ¼**
   - å…§å®¹ï¼šå®Œæ•´ç³»çµ±è¦æ ¼ã€è³‡æ–™æ¨¡å‹ã€API è¨­è¨ˆã€User Stories
   - æ”¹é€²ï¼šæ”¶æ–‚ `GET /lesson-records` ç‚ºå–®ç«¯é»ï¼ˆscope/visibilityï¼‰ã€æ–°å¢å…±äº«æŸ¥è©¢ç¯€æµã€è£œä¸Š MFA+å¯©è¨ˆéœ€æ±‚ã€`lesson_record_details` å†—é¤˜ `resort_id` èˆ‡ç°½å URL TTL èªªæ˜

2. **AI é–‹ç™¼ç´„æŸ** (Machine Readable)
   - `sdd-T-ai-constraints_20251001_094633.md`
   - å…§å®¹ï¼šAI é–‹ç™¼æ™‚å¿…é ˆéµå¾ªçš„æ ¸å¿ƒç´„æŸã€ä»»å‹™æ¨¡æ¿ã€å®Œæ•´ Schema å®šç¾©ã€å…±äº«æŸ¥è©¢æ¬Šé™æª¢æŸ¥ï¼ˆå« scope=private|shared æµç¨‹èˆ‡ Rate Limit è¦ç¯„ï¼‰
   - ç”¨é€”ï¼šçµ¦ Copilot/ChatGPT/è‡ªå‹•åŒ–å·¥å…·ä½¿ç”¨

---

## ğŸ“¦ èˆŠç‰ˆæ–‡æª” (ä¿ç•™åƒè€ƒ)

### ç‰ˆæœ¬æ­·å²ï¼š

**v2.3** (2025-10-03 12:00) - ç•¶å‰æœ€æ–°ç‰ˆ â­ï¸
- `sdd-T-spec_20251002.md`
- `sdd-T-ai-constraints_20251001_094633.md`
- æ”¶æ–‚æ•™å­¸ç´€éŒ„åˆ—è¡¨ç‚ºå–®ä¸€ç«¯é»ï¼ˆscope=private|sharedï¼‰ï¼Œå…±äº«çµæœå›å‚³è„«æ•è³‡æ–™èˆ‡ `expires_in`
- `lesson_record_details` æ–°å¢ `resort_id`ã€trigger èˆ‡å…±äº«ç´¢å¼•ï¼›RLS æ”¹ä»¥æ¬„ä½å°é½Š
- `can_view_shared_records` é è¨­ `FALSE`ï¼Œæ——æ¨™èª¿æ•´éœ€ MFA + å¯©è¨ˆï¼›å…±äº«æŸ¥è©¢åŠ ä¸Š 30 æ¬¡/åˆ†é˜ç¯€æµ

**v2.2** (2025-10-02 11:05)
- `sdd-T-spec_20251001_094633.md`
- `sdd-T-ai-constraints_20251001_094633.md`
- æ–°å¢æ•™å­¸ç´€éŒ„å…±äº«æ¬„ä½ã€APIã€RLSã€å¯©è¨ˆèˆ‡ç›£æ§æŒ‡å¼•
- æ–°å¢ `seat_identity_forms` èªé ˜å‰èº«ä»½æµç¨‹èˆ‡ç›¸é—œ API
- ç®¡ç†å“¡å¯æ§ `can_view_shared_records`ï¼Œå…±äº«æŸ¥è©¢é ˆæª¢æŸ¥æ¬Šé™

**v2.1** (2025-10-01 09:46)
- `sdd-T-spec_20251001_094633.md`
- `sdd-T-ai-constraints_20251001_094633.md`
- ä¿®æ­£ï¼š`display_order SERIAL` â†’ `INTEGER`
- è£œå……ï¼šå®Œæ•´ Schema å®šç¾©åˆ° AI ç´„æŸæ–‡ä»¶

**v2.0** (2025-09-30 20:52) - é‡æ§‹ç‰ˆ
- `sdd-T-spec_20250930_205208.md`
- `sdd-T-ai-constraints_20250930_205208.md`
- åˆä½µé‡è¤‡æ–‡æª”ã€ç°¡åŒ–éåº¦è¨­è¨ˆ

**v1.0** (2025-09-29) - åŸå§‹ç‰ˆæœ¬
- `sdd-T.md` (å­¸ç”ŸÃ—æ•™ç·´æ•´åˆç‰ˆ)
- `sdd-T-spec.md` (æ­£å¼è¦æ ¼ï¼Œ64KB)
- `sdd_t_steering_ai_instructions_v_1.md` (AI æŒ‡å¼•)
- å•é¡Œï¼šå…§å®¹é‡è¤‡ã€SERIAL èª¤ç”¨ã€éåº¦è¨­è¨ˆ

---

## ğŸ”§ é‡æ§‹æ”¹é€²æ‘˜è¦

### å•é¡Œ 1: æ–‡ä»¶è·è²¬æ··äº‚ âœ… å·²è§£æ±º
- **èˆŠç‹€æ³**: å…©ä»½ 90% ç›¸åŒçš„è¦æ ¼æ–‡ä»¶
- **æ–°è¨­è¨ˆ**: å–®ä¸€ä¸»è¦æ ¼ + AI å°ˆç”¨ç´„æŸæ–‡ä»¶

### å•é¡Œ 2: position é‚è¼¯éæ–¼è¤‡é›œ âœ… å·²ç°¡åŒ–
- **èˆŠè¨­è¨ˆ**: å‰ç«¯å‚³ `position: 1, 2, 3...`ï¼Œå¾Œç«¯æª¢æŸ¥é€£çºŒæ€§
- **æ–°è¨­è¨ˆ**: å¾Œç«¯ç¶­è­· `display_order` INTEGERï¼Œç”± Service å±¤é‡æ–°ç·¨è™Ÿï¼Œå‰ç«¯åªå‚³ ID é™£åˆ—
- **è£œå……**: é‡æ’éœ€æ¯”å° ID é›†åˆä¸¦åŒ…åœ¨äº¤æ˜“å…§ï¼Œé˜²æ¼å¯«é€ æˆäº‚åº

### å•é¡Œ 3: è©•é‡ç¹¼æ‰¿éåº¦è¨­è¨ˆ âœ… å·²ç°¡åŒ–
- **èˆŠè¨­è¨ˆ**: DB åŠ  `inheritance_depth CHECK <= 2` ç´„æŸ
- **æ–°è¨­è¨ˆ**: å–®å±¤ `source_rating_id` å¼•ç”¨ï¼Œæ·±åº¦æª¢æŸ¥åœ¨ Service å±¤
- **è£œå……**: Service å±¤å¿…é ˆé˜²å¾ªç’°å¼•ç”¨ä¸¦éµå®ˆå¯é…ç½®æœ€å¤§å±¤æ•¸

### å•é¡Œ 4: ç›£è­·äººæµç¨‹è¤‡é›œ âœ… å·²ç°¡åŒ–
- **èˆŠè¨­è¨ˆ**: ç”¨ `(guardian_email, student_name, birth_date)` ä¸‰æ¬„ä½åŒ¹é…
- **æ–°è¨­è¨ˆ**: UUID é‚€è«‹é€£çµ `/invite/student/{uuid}?token={code}`
- **è£œå……**: token é›œæ¹Šå„²å­˜ã€é è¨­ 7 å¤© TTLï¼ŒæˆåŠŸèªé ˜å³å¤±æ•ˆ

### å•é¡Œ 5: å¸­ä½ç‹€æ…‹é›£ä»¥è¿½è¹¤ âœ… å·²æ¨™æº–åŒ–
- **èˆŠç‹€æ³**: æ²’æœ‰ä¸€è‡´çš„ç‹€æ…‹è½‰ç§»ï¼ŒéæœŸé‚€è«‹ç¢¼ä¸æœƒè‡ªå‹•å›æ”¶
- **æ–°è¨­è¨ˆ**: å®šç¾© `pending â†’ invited â†’ claimed/completed` èˆ‡ `expired` æµç¨‹ï¼Œæ’ç¨‹è‡ªå‹•æ›´æ–°éæœŸç‹€æ…‹
- **è£œå……**: æ’ç¨‹è¨˜éŒ„ `job_runs` ä¸¦ç™¼é€å‘Šè­¦ï¼Œé¿å…å¤±æ•—ç„¡äººçŸ¥æ‚‰

### å•é¡Œ 6: æ¥­å‹™éŒ¯èª¤ç¢¼èˆ‡å¯¦ä½œæŒ‡å¼•åˆ†æ•£ âœ… å·²çµ±ä¸€
- **èˆŠç‹€æ³**: å„åŠŸèƒ½è‡ªè¡Œæ±ºå®šéŒ¯èª¤è¨Šæ¯ï¼Œç¼ºä¹è·¨èªè¨€æŒ‡å¼•
- **æ–°è¨­è¨ˆ**: è¦æ ¼åˆ—å‡ºæ¨™æº– BusinessError codeï¼ˆå¦‚ `ANALYSIS_SET_MISMATCH`ã€`INHERITANCE_INVALID_CHAIN`ï¼‰ï¼Œä¸¦æä¾›èªè¨€ç„¡é—œçš„ Service å±¤æº–å‰‡

### å•é¡Œ 7: æ•™å­¸ç´€éŒ„ç¼ºä¹å…±äº«æ§åˆ¶ âœ… å·²å®šç¾©
- **èˆŠç‹€æ³**: èˆŠç³»çµ±åƒ…èƒ½å…¨é‡æŸ¥è©¢ï¼Œç„¡é–‹é—œèˆ‡æ¬Šé™é™åˆ¶
- **æ–°è¨­è¨ˆ**: æ–°å¢ `share_visibility`ï¼ˆprivate/resort/allï¼‰èˆ‡æ•™ç·´æ¬Šé™ `can_view_shared_records`ï¼Œå…±äº«æŸ¥è©¢éœ€ç¶“å¯©è¨ˆèˆ‡ RLS é©—è­‰
- **æœ€æ–°è£œå…… (2025-10-03)**: æ”¶æ–‚æˆå–®ä¸€åˆ—è¡¨ç«¯é»ï¼ˆscope/visibilityï¼‰ã€æ–°å¢ `resort_id` å†—é¤˜èˆ‡ç´¢å¼•ã€å…±äº«æŸ¥è©¢åŠ ä¸Š 30 æ¬¡/åˆ†é˜ç¯€æµèˆ‡ç°½å URL TTL

### å•é¡Œ 8: èªé ˜æµç¨‹ç¼ºä¹èº«ä»½è³‡æ–™ âœ… å·²è¦åŠƒ
- **èˆŠç‹€æ³**: åªæœ‰é‚€è«‹é€£çµ (UUID)ï¼Œç„¡æ³•é©—è­‰å­¸ç”Ÿ/ç›£è­·äººæ˜¯å¦æ‹¿éŒ¯
- **æ–°è¨­è¨ˆ**: è¨­è¨ˆ `seat_identity_forms` æ”¶é›†å­¸ç”Ÿå§“å/Email/ç”Ÿæ—¥ï¼Œèªé ˜å‰å¿…é ˆå®Œæˆä¸¦é¡¯ç¤ºç¢ºèªè³‡è¨Šï¼Œå¯æ’¤éŠ·é‡å¡«ï¼Œèˆ‡ä¿éšªæµç¨‹è§£è€¦

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### é–‹ç™¼äººå“¡
1. é–±è®€ `sdd-T-spec_20251002.md` äº†è§£æœ€æ–°å®Œæ•´ç³»çµ±è¨­è¨ˆ
2. é–‹ç™¼æ™‚åƒè€ƒ `sdd-T-ai-constraints_20251001_094633.md` çš„æ ¸å¿ƒç´„æŸ
3. é‡åˆ°ç–‘å•æ™‚å¯æŸ¥é–±èˆŠæ–‡æª”æ­·å²è„ˆçµ¡

### AI å·¥å…·
1. è¼‰å…¥ `sdd-T-ai-constraints_20251001_094633.md` ä½œç‚ºç³»çµ±æç¤ºè©
2. éµå¾ªå…¶ä¸­çš„ç´„æŸèˆ‡æ¨¡æ¿
3. è¼¸å‡ºå‰ä½¿ç”¨ã€Œè‡ªæˆ‘æª¢æŸ¥æ¸…å–®ã€é©—è­‰

### å°ˆæ¡ˆç®¡ç†
1. ä¸»è¦æ ¼ä½œç‚ºå”¯ä¸€äº‹å¯¦ä¾†æº
2. è®Šæ›´éœ€æ›´æ–°ä¸»è¦æ ¼ä¸¦åŠ ä¸Šæ–°çš„æ™‚é–“æˆ³ç‰ˆæœ¬
3. èˆŠç‰ˆæœ¬æ–‡æª”ä¸åˆªé™¤ï¼Œä½œç‚ºæ­·å²åƒè€ƒ

---

## ğŸ”„ ç‰ˆæœ¬å‘½åè¦å‰‡

```
sdd-T-spec_YYYYMMDD[_HHMMSS].md
           ^^^^^^^^  ^^^^^^
           æ—¥æœŸ       ï¼ˆé¸å¡«ï¼‰æ™‚é–“

ç¯„ä¾‹:
sdd-T-spec_20251002.md          # 2025å¹´10æœˆ2æ—¥ 12:00:00 ç™¼ä½ˆ
sdd-T-spec_20251001_094633.md   # 2025å¹´10æœˆ1æ—¥ 09:46:33 ç™¼ä½ˆ
```

**å¥½è™•**:
- âœ… ä¸€çœ¼çœ‹å‡ºå“ªå€‹æ˜¯æœ€æ–°ç‰ˆ (æ•¸å­—è¶Šå¤§è¶Šæ–°)
- âœ… ä¸æœƒææ··ç‰ˆæœ¬
- âœ… å¯ä»¥è¿½æº¯æ­·å²è®Šæ›´
- âœ… éœ€è¦æ›´ç´°ç²’åº¦æ™‚å¯åŠ æ™‚é–“æˆ³ï¼Œå¦å‰‡ä»¥æ—¥æœŸå³å¯

---

## ğŸ¯ ä½•æ™‚å»ºç«‹æ–°ç‰ˆæœ¬ï¼Ÿ

### âœ… å¿…é ˆå»ºæ–°ç‰ˆæœ¬ (Major Change)
- **è³‡æ–™è¡¨çµæ§‹è®Šæ›´** (æ–°å¢/åˆªé™¤æ¬„ä½ã€æ”¹å‹åˆ¥ã€æ”¹ç´„æŸ)
- **API è·¯å¾‘æˆ–åƒæ•¸è®Šæ›´** (ç ´å£æ€§æ”¹å‹•)
- **æ¥­å‹™è¦å‰‡èª¿æ•´** (å¦‚ç¹¼æ‰¿æ·±åº¦ã€è©•é‡è¦å‰‡ã€æ’åºé‚è¼¯)
- **æ¶æ§‹é‡æ§‹** (å¦‚æ¬Šé™æ¨¡å‹ã€ä½µç™¼æ§åˆ¶æ©Ÿåˆ¶)
- **ä¿®æ­£è¨­è¨ˆéŒ¯èª¤** (å¦‚ SERIAL èª¤ç”¨ã€éåº¦è¨­è¨ˆ)

**æ“ä½œ**ï¼šå»ºç«‹æ–°æª”æ¡ˆ `sdd-T-spec_YYYYMMDD_HHMMSS.md`

### ğŸ“ å¯ä¸å»ºæ–°ç‰ˆæœ¬ (Minor Change)
- ä¿®æ­£éŒ¯å­—ã€æ¨™é»ç¬¦è™Ÿ
- èª¿æ•´æ ¼å¼ã€æ’ç‰ˆ
- æ–°å¢è¨»è§£æˆ–ä½¿ç”¨ç¯„ä¾‹
- è£œå……ä½¿ç”¨èªªæ˜
- æ›´æ–°å¾…è¾¦äº‹é …æ¸…å–®

**æ“ä½œ**ï¼šç›´æ¥ç·¨è¼¯æœ€æ–°ç‰ˆæœ¬

### ğŸ” åˆ¤æ–·æ¨™æº–

**å•è‡ªå·±**ï¼š
1. é€™å€‹è®Šæ›´æœƒå½±éŸ¿é–‹ç™¼è€…çš„å¯¦ä½œå—ï¼Ÿ â†’ æ˜¯ = Major
2. é€™å€‹è®Šæ›´æœƒæ”¹è®Šè³‡æ–™åº« Schema å—ï¼Ÿ â†’ æ˜¯ = Major
3. é€™å€‹è®Šæ›´æœƒè®“ç¾æœ‰ç¨‹å¼ç¢¼éŒ¯èª¤å—ï¼Ÿ â†’ æ˜¯ = Major
4. é€™å€‹è®Šæ›´åªæ˜¯è®“æ–‡ä»¶æ›´æ¸…æ¥šå—ï¼Ÿ â†’ æ˜¯ = Minor

**ç¯„ä¾‹**ï¼š
- âœ… Major: `display_order SERIAL` â†’ `INTEGER` (å½±éŸ¿å¯¦ä½œ)
- ğŸ“ Minor: è£œå……ã€Œç‚ºä»€éº¼ç”¨ INTEGERã€çš„èªªæ˜ (ä¸å½±éŸ¿å¯¦ä½œ)

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼ˆå¾…ç¢ºèªå„ªå…ˆé †åºï¼‰

- [ ] å»ºç«‹ `api-contract.yaml` (OpenAPI è¦æ ¼)
- [ ] å»ºç«‹ `docs/erd.png` (ER Diagram)
- [ ] å»ºç«‹ `docs/wireframes/` (å‰ç«¯è¨­è¨ˆç¨¿)
- [ ] å»ºç«‹ `migrations/` (è³‡æ–™åº«é·ç§»è…³æœ¬)
- [ ] å¯¦ä½œé‚€è«‹ç¢¼ç”¢ç”Ÿé‡è©¦æ©Ÿåˆ¶ï¼ˆæœ€å¤š 5 æ¬¡ï¼Œå¦å‰‡å›å‚³ `INVITE_CODE_COLLISION`ï¼‰
- [ ] å»ºç«‹é‚€è«‹ç¢¼éæœŸæ¸…ç†æ’ç¨‹ï¼ˆæ›´æ–° seat ç‹€æ…‹ç‚º `expired` ä¸¦å›æ”¶è¨˜éŒ„ï¼‰
- [ ] ä¾ Service å±¤æº–å‰‡æ’°å¯«èªè¨€ç„¡é—œé–‹ç™¼æ‰‹å†Šï¼ˆæµç¨‹/æ™‚åº/éŒ¯èª¤ç¢¼å°ç…§ï¼‰
- [ ] å¯¦ä½œæ•™å­¸ç´€éŒ„å…±äº«è¨­å®š/æŸ¥è©¢ APIã€å‰ç«¯é–‹é—œèˆ‡å¯©è¨ˆç´€éŒ„
- [ ] ç®¡ç†å“¡å¾Œå°è£œä¸Š `can_view_shared_records` æ¬Šé™ç¶­è­·
- [x] è£œè¶³å…±äº« API çš„ `scope`/`visibility` æˆæ¬Šæµç¨‹èˆ‡è„«æ•ç­–ç•¥
- [ ] å¯¦ä½œ `seat_identity_forms` è¡¨å–®ï¼ˆå¾Œå° + å…¬é–‹ç«¯é»ï¼‰èˆ‡èªé ˜å‰é©—è­‰
- [ ] é‚€è«‹ç¢ºèªé é¡¯ç¤ºèº«ä»½è³‡è¨Šä¸¦å…è¨±æ’¤éŠ·é‡æ–°å¡«å¯«

---

**ç¶­è­·**: æ¯æ¬¡é‡å¤§è¨­è¨ˆè®Šæ›´æ™‚å»ºç«‹æ–°ç‰ˆæœ¬ï¼Œæª”ååŠ ä¸Šæ™‚é–“æˆ³ã€‚
**è¯çµ¡**: æœ‰å•é¡Œè«‹æŸ¥é–±ä¸»è¦æ ¼æˆ– AI ç´„æŸæ–‡ä»¶çš„ã€Œç›¸é—œæ–‡æª”ã€ç« ç¯€ã€‚
